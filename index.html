<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Christos Maris clerk.dev assignment</title>

  <style>
    body {
      margin: 0;
      width: 100vw;
    }

    #app {
      align-items: center;
      display: flex;
      flex-direction: column;
    }

    fieldset {
      align-items: center;
      display: flex;
      width: fit-content;
    }

    fieldset>legend {
      padding: 0 7px;
    }

    fieldset>input:first-of-type {
      margin-right: 10px;
    }

    #card-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      list-style: none;
    }

    .card {
      align-items: center;
      border: 2px solid;
      display: flex;
      flex-direction: column;
      flex-shrink: 1;
      margin: 30px 15px 0;
      padding: 10px;
      width: 250px;
    }

    .card>* {
      margin: 15px 0;
    }

    .card>img {
      border-radius: 50%;
    }
  </style>
</head>

<body>
  <div id="app">loading...</div>

  <script>
    class BackgroundColor {
      constructor(hex) {
        // Input hex
        this.hex = hex;

        // Contrast hex: black | white;
        // Logic adapted from: https://css-tricks.com/css-variables-calc-rgb-enforcing-high-contrast-colors/
        const rgb = hex.replace('#', '').match(/.{2}/g).map(intensity => parseInt(intensity, 16));
        const sum = (
          (rgb[0] * 299) +
          (rgb[1] * 587) +
          (rgb[2] * 114)
        ) / 1000;

        this.contrastHex =
          sum > 128
            ? '#000000'
            : '#ffffff';
      }
    };

    const App = {};

    App.stateChangeHandler = {
      set: function (state, key, value) {
        key === 'fromObject'
          ? Object.assign(state, value)
          : state[key] = value;
        localStorage.state = JSON.stringify(state);

        App.rerender();
      },
    };

    App.state = new Proxy(
      JSON.parse(localStorage.state ||= JSON.stringify({ backgroundColor: new BackgroundColor('#007e7e') })),
      App.stateChangeHandler
    );

    App.rerender = function () {
      const html = `
        <h1>My Clerks</h1>

        <fieldset style="border: ${App.state.backgroundColorError ? '4px solid red' : '2px solid black'};">
          <legend>Card Background Color</legend>
          ${['text', 'color'].map(inputType => `
            <input
              type="${inputType}"
              id="color-picker-${inputType}"
              onchange="App.backgroundColorChange('${inputType}');"
              value=${App.state.backgroundColor.hex}
            >
          `).join('')}
        </fieldset>

        <div id="card-container">
          ${[0, 1, 2].map(() => `
            <div
              class="card"
              style="background-color: ${App.state.backgroundColor.hex}; color: ${App.state.backgroundColor.contrastHex};"
            >
              <img src="https://randomuser.me/api/portraits/women/10.jpg" alt="Profile picture of Marie Cole" />
              <h2>Kirsten Something</h2>
              <p>Street name and number</p>
              <p>email@example.com</p>
              <p>+1-500-MY-NUMBER</p>
            </div>
          `).join('')}
        </div>
      `;

      document.getElementById('app').innerHTML = html;
    };

    App.validate = ({
      hexColor,
    }) => {
      if (hexColor) {
        return /^#[0-9a-fA-F]{6}$/.exec(hexColor);
      }
    };

    App.backgroundColorChange = inputType => {
      const inputId = `color-picker-${inputType}`;
      const inputValue = document.getElementById(inputId).value;

      App.state.fromObject =
        App.validate({ hexColor: inputValue })
          ? { backgroundColorError: false, backgroundColor: new BackgroundColor(inputValue) }
          : { backgroundColorError: true };
    };

    // Helps us avoid shooting ourselves in the foot.
    Object.freeze(App);

    // Initial App render
    App.rerender();
  </script>
</body>

</html>